:::: container
[CRM Portal]({{ url_for('index') }}){.navbar-brand}

[]{.navbar-toggler-icon}

::: {#navbarNav .collapse .navbar-collapse}
-   [Add Lead]({{ url_for('index') }}){.nav-link}
-   [View Followups]({{ url_for('followups') }}){.nav-link .active}

-   [Welcome, {{ current_user.name }}]{.nav-link}
-   [Logout]({{ url_for('logout') }}){.nav-link}
:::
::::

::::::::::::::::: {.container .mt-4}
{% with messages = get_flashed_messages(with_categories=true) %} 
{% if messages %} 
{% for category, message in messages %}

::: {.alert .alert-{{ category }} .alert-dismissible .fade .show}
{{ message }}

[Ã—]{.btn-close data-bs-dismiss="alert"}
:::

{% endfor %} 
{% endif %} 
{% endwith %}

::::::::::: {.card .shadow-sm .mb-4}
::: {.card-header .bg-white}
##### Search Followups {.card-title .mb-0}
:::

::::::::: card-body
<form method="GET" action="{{ url_for('followups') }}">
::::::: row
{% if current_user.is_admin %}

:::: col-md-6
::: mb-3
<label class="form-label">Team Member</label>
<select name="member_id" class="form-select">
    <option value="">All Team Members</option>
    {% for member in team_members %}
        <option value="{{ member.id }}" {% if selected_member_id == member.id|string %}selected{% endif %}>
            {{ member.name }}
        </option>
    {% endfor %}
</select>
:::
::::

{% endif %}

:::: {.col-md-{% if current_user.is_admin %}6{% else %}12{% endif %}}
::: mb-3
<label class="form-label">Followup Date</label>
<input type="date" name="followup_date" class="form-control" value="{{ request.args.get('followup_date', '') }}">
:::
::::
:::::::

::: {.d-grid .gap-2 .d-md-flex .justify-content-md-end}
<button type="submit" class="btn btn-primary me-md-2">Search</button>
[Reset]({{ url_for('followups') }}){.btn .btn-secondary}
:::
</form>
:::::::::
:::::::::::

:::::: {.card .shadow-sm}
::: {.card-header .bg-white .d-flex .justify-content-between .align-items-center}
##### {% if current_user.is_admin %}{% if selected_member_id %}{% for member in team_members %}{% if member.id|string == selected_member_id|string %}Leads for {{ member.name }}{% endif %}{% endfor %}{% else %}All Team Leads{% endif %}{% else %}Your Leads{% endif %} {.card-title .mb-0}
:::

:::: card-body
::: table-responsive
<table class="table">
    <thead>
        <tr>
            <th>Customer Name</th>
            <th>Mobile</th>
            <th>Followup Date</th>
            <th>Remarks</th>
            <th>Created At</th>
            {% if current_user.is_admin %}
            <th>Created By</th>
            {% endif %}
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% if followups %}
        {% for followup in followups %}
        <tr>
            <td>{{ followup.customer_name }}</td>
            <td>
                <span class="mobile-number text-primary" style="cursor: pointer; text-decoration: underline;" data-mobile="{{ followup.mobile }}" title="Click to call">
                    {{ followup.mobile }}
                </span>
            </td>
            <td>{{ followup.followup_date.strftime('%Y-%m-%d') }}</td>
            <td>{{ followup.remarks }}</td>
            <td>{{ followup.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
            {% if current_user.is_admin %}
            <td>{{ followup.creator.name }}</td>
            {% endif %}
            <td>
                <div class="btn-group" role="group">
                    <a href="https://wa.me/{{ followup.mobile }}" 
                       target="_blank" 
                       class="btn btn-success btn-sm" 
                       title="Open WhatsApp Chat">
                        <i class="fab fa-whatsapp"></i>
                    </a>
                    {% if current_user.is_admin or followup.creator_id == current_user.id %}
                    <a href="{{ url_for('edit_lead', lead_id=followup.id) }}" 
                       class="btn btn-primary btn-sm" 
                       title="Edit Lead">
                        <i class="fas fa-edit"></i>
                    </a>
                    <form action="{{ url_for('delete_lead', lead_id=followup.id) }}" 
                          method="POST" 
                          class="d-inline" 
                          onsubmit="return confirm('Are you sure you want to delete this lead?');">
                        <button type="submit" 
                                class="btn btn-danger btn-sm" 
                                title="Delete Lead">
                            <i class="fas fa-trash"></i>
                        </button>
                    </form>
                    {% endif %}
                </div>
            </td>
        </tr>
        {% endfor %}
        {% else %}
        <tr>
            <td colspan="{% if current_user.is_admin %}7{% else %}6{% endif %}" class="text-center">
                No followups found for the selected criteria
            </td>
        </tr>
        {% endif %}
    </tbody>
</table>
:::
::::
::::::
:::::::::::::::::

<style>
    .mobile-number:hover {
        color: #0056b3 !important;
    }
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/js/all.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const mobileNumbers = document.querySelectorAll('.mobile-number');
        
        mobileNumbers.forEach(function(element) {
            element.addEventListener('click', function() {
                const mobileNumber = this.getAttribute('data-mobile');
                
                // For mobile browsers
                if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                    window.location.href = 'tel:' + mobileNumber;
                } else {
                    // For desktop, copy to clipboard
                    navigator.clipboard.writeText(mobileNumber).then(function() {
                        alert('Mobile number copied: ' + mobileNumber);
                    });
                }
            });
        });
    });
</script>